<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React-Redux todoList</title>
</head>
<body>
<div id="app"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
<script type="text/babel">
    const {createStore,combineReducers} = Redux;
    let nextTodoId = 0;

    function todos(state = [],action){
        switch(action.type){
            case "ADD_TODO":
                return [
                    ...state,
                    {
                        id:action.id,
                        text:action.text,
                        completed:false
                    }
                ]
            case "TOGGLE_TODO":
                return state.map((todo) => {
                    return todo.id === action.id ? {...todo,completed:!todo.completed} : todo
                })
            default:
            return state;
        }
    }
    function visibilityFilter (state = "SHOW_ALL",action){
        switch(action.type){
            case "SET_VISIBILITY_FILTER":
                return action.filter
            default:
                return state;
        }
    }

    const reducer = combineReducers({
        todos,
        visibilityFilter
    })

    const store = createStore(reducer);
    class App extends React.Component {
        constructor(props){
            super(props);
            this.state = {
                value:""
            }
            this.inputRef = React.createRef();
        }
        handleInput = (event) => {
            this.setState({
                value:event.target.value
            })
        }
        render(){
            return (
                <div>
                    <h3>React-Redux  TodoList</h3>
                    <input
                        type="text"
                        ref={this.inputRef}
                        onChange={this.handleInput}
                    />
                    {" "}
                    <input
                        type="button"
                        defaultValue="Add Todo"
                        onClick={() => {
                            store.dispatch({
                                type:"ADD_TODO",
                                id:nextTodoId++,
                                text:this.state.value
                            })
                            this.state.value = "";
                        }}
                    />
                    <ul>
                        {this.props.todos.map((todo) =>
                            <li
                                key={todo.id}
                                onClick={() => {
                                    store.dispatch({
                                        type:"TOGGLE_TODO",
                                        id:todo.id
                                    })
                                }}
                                style={{
                                    textDecoration:todo.completed
                                        ? "line-through"
                                        : "none"
                                }}
                            >{todo.text}</li>
                        )}
                    </ul>
                    <p>
                        <span>Show: </span>
                        <a href="#">All </a>
                        <a href="#">Active </a>
                        <a href="#">Completed </a>
                    </p>
                </div>
            )
        }
    }
    const render = () => {
        ReactDOM.render(
            <App
                todos={store.getState().todos}
            />,
            document.getElementById("app")
        )
    }
    render();
    store.subscribe(render);

</script>
</body>
</html>