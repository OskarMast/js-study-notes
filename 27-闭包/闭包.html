<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>闭包</title>
    <style>
        body{
            font-size:12px;
        }
        .text{
            font-size:1em;
        }
    </style>
</head>
<body>
<p class="text">Hello World</p>
<button class="btn1">12</button>
<button class="btn2">14</button>
<button class="btn3">16</button>
<p id="help">Helpful notes will appear here</p>
<p>E-email: <input type="text" id="email" name="email"></p>
<p>Name: <input type="text" id="name" name="name"></p>
<p>Age: <input type="text" id="age" name="age"></p>

<script type="text/javascript">

    function changeSize(size){
        return () => document.body.style.fontSize = size + 'px';
    }
    const oBtn1 = document.querySelector('.btn1');
    oBtn1.onclick = changeSize(12);

    document.querySelector('.btn2').onclick = changeSize(14);

    document.querySelector('.btn3').onclick = changeSize(16);



    function init(){
        var name = 'Mozilla';
        function displayName(){
            console.log(name);
        }
        displayName();
    }
    init();


    function makeAdder(x){
        return function(y){
            return x + y;
        }
    }

    const add5 = makeAdder(5);
    const add10 = makeAdder(10);
    // add5 和 add10 共同享受相同的函数定义,但是保存了不同的词法环境。
    console.log(add5(2));   // 7
    console.log(add10(2));  // 12


    var Counter = (function(){
        var privateCounter = 0;
        function changeBy(val){
            privateCounter += val;
        }
        return {
            increment:function(){
                changeBy(1)
            },
            decrement:function(){
                changeBy(-1);
            },
            value:function(){
                return privateCounter;
            }
        }
    })();

    // 只创建了一个词法环境,为三个函数所共享。Counter.increment Counter.decrement 和 Counter.value.
    Counter.increment();
    Counter.increment();
    console.log(Counter.value());   // 2

    Counter.decrement();
    console.log(Counter.value());   // 1
</script>
<script>
    function showHelp(help){
        document.getElementById('help').textContent = help;
    }
    function setupHelp(){
        var helpText = [
            {id:'email',help:'Your e-mail address'},
            {id:'name',help:'Your full name'},
            {id:'age',help:'Your age (you must be over 16)'}
        ];
        for(var i = 0; i < helpText.length; i++){
            (function(i){
                var item = helpText[i];
                document.getElementById(item.id).onfocus = function(){
                    showHelp(item.help);
                }
            })(i)
        }
    }
    setupHelp();

    function foo(){
        var a = 2;
        function bar(){
            console.log(a); // 2
        }
        bar();
    }
    foo();
    // 下面的代码清晰展示了闭包:

    function baz(){
        var a = 2;
        function foo(){
            console.log(a); // 2
        }
        return foo;
    }
    var c = baz();
    c()


</script>
<script>
    function foo(){
        var a = 2;
        function baz(){
            console.log(a);
        }
        bar(baz);
    }
    function bar(fn){
        fn();
    }
    foo();

</script>
<script>
    var fn;
    function foo(){
        var a = 'hello 闭包';
        function baz(){
            console.log(a);
        }
        fn = baz;
    }
    function bar(){
        fn();
    }
    foo();
    bar();

    function wait(message){
        const timer = setTimeout(() => {
            console.log(message);
        },1000);
    }
    wait('Hello course!');
    wait('Hello React');

    var a = 'Hello World!';
    (function(){
        console.log(a);
    })();
</script>
<script>
/*    for(var i = 0; i <= 5; i++){
        setTimeout(function(){
            console.log(i);
        },i*1000);
    }

    for(var i =0; i <= 5; i++){
        (function(i){
            setTimeout(() => {
                console.log(i);
            },i * 1000);
        })(i)
    }

    for(var i = 0; i <=5; i++){
        (function(){
            var j = i;
            setTimeout(() => {
                console.log(j);
            },j*1000);
        })()
    }*/

</script>
<script>
    for(var i = 0; i <= 5; i++){
        let j = i;  // 闭包的块作用域
        setTimeout(() => {
            console.log(j);
        },i * 1000);
    }

    for(let j = 0; j <= 5; j++){
        setTimeout(function timer(){
            console.log(j);
        },j * 1000);
    }

    function coolModule(){
        var something = 'cool';
        var another = [1,2,3];
        function doSomething(){
            console.log(something);
        }
        function doAnother(){
            console.log(another.join("!"));
        }
        return {
            doSomething:doSomething,
            doAnother:doAnother
        }
    }
    var foo = coolModule();
    foo.doSomething();
    foo.doAnother();

    // 当只需要一个实例时,可以对这个模块进行简单的改进来实现单例模式。
    var bar = (function coolModule(){
        var something = 'Hello World';
        var another = ['hello','world'];
        function doSomething(){
            console.log(something);
        }
        function doAnother(){
            console.log(another.join('!'));
        }
        return {
            doSomething:doSomething,
            doAnother:doAnother
        }
    })();

    bar.doSomething();
    bar.doAnother();

    function CoolModule(id){
        function identify(){
            console.log(id);
        }
        return {
            identify:identify
        }
    }
    var foo1 = CoolModule('foo1');
    var foo2 = CoolModule('foo2');

    foo1.identify();    // foo1
    foo2.identify();    // foo2


</script>
<script>
    var demo = (function coolModule(id){
        function change(){
            publicApi.identify = identify2;
        }
        function identify1(){
            console.log(id);
        }
        function identify2(){
            console.log(id.toUpperCase());
        }
        var publicApi = {
            change:change,
            identify:identify1
        }
        return publicApi;
    })('foo module');

    demo.identify();    //
    demo.change();
    demo.identify();




</script>
<script>
    var count = (function counter(){
        var privateCounter = 0;
        function change(value){
            privateCounter += value;
        }
        return {
            increment:function(){
                change(1);
            },
            decrement:function(){
                change(-1);
            },
            value:function(){
                console.log(privateCounter);
            }
        }
    })();
    count.increment();
    count.value();
    count.increment();
    count.increment();
    count.value();

</script>

<script>
    function m1(){
        console.log(d);
    }
    function m2(){
        var d = 3;
        m1();
    }
    var d = 4;
    m2();
</script>

</body>
</html>