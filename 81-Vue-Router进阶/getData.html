<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>获取数据的两种方式</title>
		<style>
			body,ul,ol{
				padding: 0;
				margin: 0;
			}
			ul,ol{
				list-style:none;
			}
			#app{
				margin:0 auto;
				width:800px;
				height:auto;
				border:1px solid pink;
			}
			.list{
				list-style:none;
				height:40px;
				line-height:40px;
				display:flex;
				justify-content:space-around;
				background-color:#f1f1f1;
				width:800px;
			}
			.banner,.mv-box,.album-box{
				height:300px;
				width:800px;
			}
			.wrapper{
				position:relative;
				width:800px;
				height:300px;
			}
			.wrapper>li{
				height:100%;
				width:100%;
				position:absolute;
			}
			img{
				width:100%;
				height:100%;
				display:block;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<ul class="list">
				<router-link tag="li" to="/banner">轮播图</router-link>
				<router-link tag="li" to="/songmv">推荐MV</router-link>
				<router-link tag="li" to="/album">最新专辑</router-link>
			</ul>
			<router-view></router-view>
		</div>
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
		<script>
			const Banner = Vue.component("banner",{
				template:`
				<div v-if="loading===true">
					<h5>加载中...</h5>
				</div>
				<div class="banner" v-else>
					<ul class="wrapper">
						<li v-for="(item,index) in banner" :key="index">
							<img :src="item.imageUrl">
						</li>
					</ul>
				</div>`,
				data(){
					return{
						banner:[],
						loading:true
					}
				},
				created(){
					fetch("http://localhost:3000/banner?type=0")
					.then(response => response.json())
					.then( result => {
						this.banner = result.banners;
						this.loading=false;
					})
				}
			});
			const SongMv = Vue.component("song-mv",{
				template:`<div class='mv-box'>
					<div v-if="loading===true">
						<h4>加载中.....</h4>
					</div>
					<div v-else>
						<ul class='wrapper'>
							<li v-for="(item,index) in videos" :key="index"><img :src="item.picUrl"></li>
						</ul>
					</div>
				</div>`,
				data(){
					return{
						videos:[],
						loading:true
					}
				},
				created(){
					fetch("http://localhost:3000/personalized/mv")
					.then(response => response.json())
					.then(({result}) => {
						console.log(result);
						this.videos = result;
						this.loading = false;
					})
				},
			});
			
			const Album = Vue.component("album",{
				template:`<div class='album-box'>
					<ul class='wrapper'>
						<li v-for="(item,index) in albums" :key="index"><img :src="item.picUrl"></li>
					</ul>
				</div>`,
				data(){
					return{
						albums:[]
					}
				},
				beforeRouteEnter(to,from,next){
					fetch("http://localhost:3000/album/newest")
					.then(response => response.json())
					.then((data) => {
						let albums = data.albums;
						next(vm => {
							vm.albums = albums;
							console.log(albums);
						})
					})
				},
			});
			
			const router = new VueRouter({
				routes:[
					{
						path:"/",
						recirect:Banner
					},
					{
						path:"/banner",
						component:Banner
					},
					{
						path:"/songmv",
						component:SongMv
					},
					{
						path:"/album",
						component:Album
					}
				]
			})
			new Vue({
				el:"#app",
				router
			})
		</script>
	</body>
</html>
