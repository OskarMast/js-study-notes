<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>React-ToggleList</title>
    <style>
        body,ul,ol,h3{
            padding: 0;
            margin: 0;
        }
        ul,ol{
            list-style:none;
        }
        .container{
            margin:10px auto;
            width:330px;
            background-color:rgb(54,58,69);
            text-align:center;
            color:#fff;
        }
        h3{
            height:50px;
            line-height:50px;
            background-color:rgb(56,137,212);
            user-select:none;
        }
        h3:hover{
            background-color:rgb(61,131,50);
        }
        .container .list>li{
            background-color:rgb(40,44,58);
            height:40px;
            line-height:40px;
            border-bottom:1px solid rgb(66,73,93);
            cursor:pointer;
        }
        .container .list>li:hover{
            background-color:rgb(26,203,252);
        }
        .container .city{
            margin:5px 0;
        }
    </style>
</head>
<body>
<div id="app"></div>
<script src="node_modules/babel-standalone/babel.js"></script>
<script src="node_modules/react/umd/react.development.js"></script>
<script src="node_modules/react-dom/umd/react-dom.development.js"></script>
<script type="module">
    import {city} from "./places.js"
    // 挂在到全局对象window上
    window.places = city;
</script>
</body>
</html>
<script type="text/babel">
    class Content extends React.Component{
        constructor(props){
            super(props);
            this.state = {
                arr:this.props.show,
                a:123,
                b:456
            }
            console.log(this.state.arr);
        }
        handleChange = (index) =>{
            let cityArr = this.state.arr;
            cityArr[index] = !this.state.arr[index];
            this.setState({
                arr:cityArr
            })
            this.props.fn(index);
        }
        shouldComponentUpdate(nextProps, nextState) {
            console.log(nextProps,nextState);
            return true;
        }
        render(){
            return(
                <div className="container">
                    {
                        this.props.city.map((item,index)=>{
                            return(
                                <div key={index} className="city">
                                    <h3
                                        key={index}
                                        onClick = {this.handleChange.bind(this,index)}
                                    >{item.name}</h3>
                                    {
                                        this.state.arr[index] && (
                                            <ul className="list">
                                            {
                                                item.sites.map((item,index) => {
                                                    return(
                                                        <li key={index}>{item}</li>
                                                    )
                                                })}
                                            </ul>
                                        )
                                    }
                                </div>
                            )
                        })
                    }
                </div>
            )
        }
    }
    class App extends React.Component{
        constructor(){
            super();
            this.state={
                city:places,
                arr:[true,false,false,false,false]
            }
        }
        handleCheck = (i) => {
            console.log(i);
            let arr = this.state.arr.map((item,index) => {
                // 如果点击的和遍历的index相等的话,则把该项变为true,否则都变为false
                if (i === index) return true;
                return false;
            })
            this.setState(
                arr
            )
        }

        render(){
            return(
                <Content
                    city={this.state.city}
                    show={this.state.arr}
                    fn={this.handleCheck}
                />
            )
        }
    }
    /*
    * 子组件操作父组件的数据, 在父级传递一个函数到子组件,子组件接收函数再调用,传递一个key值到父组件
    *
    *
    *
    * */
    ReactDOM.render(
        <App/>,
        document.getElementById("app")
    )
</script>
