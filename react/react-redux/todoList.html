<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React-Redux todoList</title>
    <style>
        a{
            text-decoration:none;
        }
    </style>
</head>
<body>
<div id="server"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
<script type="text/babel">
    const {createStore,combineReducers} = Redux;
    let nextTodoId = 0;

    function todos(state = [],action){
        switch(action.type){
            case "ADD_TODO":
                return [
                    ...state,
                    {
                        id:action.id,
                        text:action.text,
                        completed:false
                    }
                ]
            case "TOGGLE_TODO":
                return state.map((todo) => {
                    return todo.id === action.id ? {...todo,completed:!todo.completed} : todo
                })
            default:
            return state;
        }
    }

    function setVisibilityFilter(state="SHOW_ALL",action){
        switch(action.type){
            case "SET_VISIBILITY_FILTER":
                return action.filter
            default:
                return state;
        }
    }
    const reducer = combineReducers({
        todos,
        setVisibilityFilter
    })
    const store = createStore(reducer);

    function FooterLink({children,filter,currentFilter}){
        if(currentFilter === filter){
            return (
                <span>{children}</span>
            )
        }
        return (
            <a href="#"
                onClick={(event) => {
                    event.preventDefault();
                    store.dispatch({
                        type:"SET_VISIBILITY_FILTER",
                        filter
                    })
                }}
            >{children}</a>
        )
    }

    function VisibleTodoList(todos,filter){
        switch(filter){
            case "SHOW_ALL":
                return todos;
            case "SHOW_ACTIVE":
                return todos.filter((todo) => !todo.completed);
            case "SHOW_COMPLETED":
                return todos.filter((todo) => todo.completed);
        }
    }
    class App extends React.Component {
        constructor(props){
            super(props);
            this.state = {
                value:""
            }
            this.inputRef = React.createRef();
        }
        handleInput = (event) => {
            this.setState({
                value:event.target.value
            })
        }
        VisibleTodoList = (todos,filter) =>{
            switch(filter){
                case "SHOW_ALL":
                    return todos;
                case "SHOW_ACTIVE":
                    return todos.filter((todo) => !todo.completed);
                case "SHOW_COMPLETED":
                    return todos.filter((todo) => todo.completed);
            }
        }
        render(){
            const {todos,visibilityFilter} = this.props;
            const getVisibleTodos = this.VisibleTodoList(
                todos,
                visibilityFilter
            )
            return (
                <div>
                    <h3>React-Redux  TodoList</h3>
                    <input
                        type="text"
                        ref={this.inputRef}
                        onChange={this.handleInput}
                        value={this.state.value}
                    />
                    {" "}
                    <input
                        type="button"
                        defaultValue="Add Todo"
                        onClick={() => {
                            if(this.state.value === ""){
                                window.alert("todo 不能为空");
                                return;
                            }
                            store.dispatch({
                                type:"ADD_TODO",
                                id:nextTodoId++,
                                text:this.state.value
                            })
                            this.setState({
                                value:""
                            })
                        }}
                    />
                    <ul>
                        {getVisibleTodos.map((todo) =>
                            <li
                                key={todo.id}
                                onClick={() => {
                                    store.dispatch({
                                        type:"TOGGLE_TODO",
                                        id:todo.id
                                    })
                                }}
                                style={{
                                    textDecoration:todo.completed
                                        ? "line-through"
                                        : "none"
                                }}
                            >{todo.text}</li>
                        )}
                    </ul>
                    <p>
                        <span>Show: </span>
                        <FooterLink
                            filter="SHOW_ALL"
                            currentFilter={visibilityFilter}
                        >All </FooterLink>{" "}
                        <FooterLink
                            filter="SHOW_ACTIVE"
                            currentFilter={visibilityFilter}
                        >Active </FooterLink>{" "}
                        <FooterLink
                            filter="SHOW_COMPLETED"
                            currentFilter={visibilityFilter}
                        >Completed </FooterLink>{" "}
                    </p>
                </div>
            )
        }
    }
    const render = () => {
        ReactDOM.render(
            <App
                todos={store.getState().todos}
                visibilityFilter={store.getState().setVisibilityFilter}
            />,
            document.getElementById("server")
        )
    }
    render();
    store.subscribe(render);

</script>
</body>
</html>