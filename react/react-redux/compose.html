<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compose使用</title>
</head>
<body>
<div id="server"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/7.1.3/react-redux.js"></script>
<script src="https://unpkg.com/redux-thunk@2.3.0/dist/redux-thunk.min.js"></script>

<script type="text/babel">
    class App extends React.Component{
        constructor(props){
            super(props);
        }
        componentDidMount(){
            this.props.getplayerAsync();
        }
        render(){
            console.log(this.props);
            return (
                <div>
                    <h3 className="title">Compose</h3>
                    <ol>
                        {this.props.players && this.props.players.length > 0
                            ? this.props.players.map((player,index) =>
                                <li key={index}>
                                    <span>FirstName:{player.firstName}</span>
                                    <span>LastName:{player.lastName}</span>
                                    <span>Age:{player.age}</span>
                                </li>
                            )
                            :"Loading......"
                        }
                    </ol>
                </div>
            )
        }
    }
    const {createStore,applyMiddleware,compose} = Redux;
    const ReduxThunk = window.ReduxThunk.default;
    const {connect,Provider} = ReactRedux;
    const mapStateToProps = state => ({players:state});
    App = connect(mapStateToProps,{getplayerAsync})(App);

    function reducer(state=[],action){
        switch(action.type){
            case "GET_PLAYER":
                return action.players;
            default:
                return state;
        }
    }

    function getplayer(players){
        return {
            type:"GET_PLAYER",
            players
        }
    }

    function getplayerAsync(){
        return dispatch => {
            setTimeout(() => {
                return fetch("http://localhost:3000/api/player")
                    .then(response => response.json())
                    .then(res => {
                        let players = res;
                        dispatch(getplayer(players))
                    })
            },2000)
        }
    }

    const store = createStore(
        reducer,
        compose(
            applyMiddleware(ReduxThunk),
            window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
        )
    );
    ReactDOM.render(
        <Provider store={store}>
            <App/>
        </Provider>,
        document.getElementById("server")
    )

</script>
</body>
</html>