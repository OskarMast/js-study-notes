<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React-todoList</title>
    <style>
        body,ul,ol,p{
            padding: 0;
            margin: 0;
        }
        ul,ol{
            list-style:none;
        }
        .todoList-wrapper{
            margin:10px auto 0;
            width:300px;
            height:300px;
            box-shadow:3px 3px 30px 2px rgba(0,0,0,.1);
        }
        label.completed{
            text-decoration:line-through;
            color:#ccc;
        }
        .control{
            text-align:center;
        }
        .control input[type='text']{
            width:200px;
            margin-right:15px
        }
    </style>
</head>
<body>
<div id="server"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script type="text/babel">
    let nextId = new Date().getTime();
    function Control({addTodo}){
        console.log('control render');
        const inputRef = React.useRef();
        const onSubmit = (event) => {
            event.preventDefault();
            let text = inputRef.current.value.trim();
            if(text.length === 0) return;
            addTodo({
                text,
                id:nextId++,
                completed:false
            });
            inputRef.current.value = "";
        }
        return (
            <div className="control">
                <form onSubmit={onSubmit}>
                    <input
                        type="text"
                        placeholder="What needs to be done?"
                        ref={inputRef}
                    />
                    <input type="submit"/>
                </form>
            </div>
        )
    }
    function Todos({todos,toggleTodo,removeTodo}){
        console.log("todos render");
        const handleToggle = (id) =>{
            toggleTodo(id);
        }
        const handleRemove = (id) => {
            console.log('remove',id)
            removeTodo(id);
        }
        return (
            <ul>
                {todos.length > 0 && todos.map(todo =>
                    <li key={todo.id}>
                        <input
                            type="checkbox"
                            checked={todo.completed}
                            onChange={() => {
                                handleToggle(todo.id)
                            }}
                        />
                        <label
                            className={ todo.completed ? "completed": "" }
                        >{todo.text}</label>
                        <button onClick={() => {
                            handleRemove(todo.id)
                        }}>X</button>
                    </li>
                )}
            </ul>
        )
    }
    function TodoList(){
        const [todos,setTodos] = React.useState([]);
        const addTodo = React.useCallback((todo) => {
            setTodos(todos => {
                return [...todos,todo]
            })
        },[])
        const toggleTodo = React.useCallback((id) => {
            setTodos(todos => todos.map((todo) => {
                return todo.id === id
                    ? {...todo,completed:!todo.completed}
                    : todo;
            }))
        },[])
        const removeTodo = React.useCallback((id) => {
            setTodos(todos => todos.filter((todo) => {
                return todo.id !== id;
            }))
        },[])
        /*读取todos*/
        React.useEffect(() => {
            const todos = JSON.parse(window.localStorage.getItem('todos') || "[]");
            setTodos(todos);
        },[])
        React.useEffect(() => {
            window.localStorage.setItem("todos",JSON.stringify(todos));
        },[todos]);
        return (
            <div className="todoList-wrapper">
                <Control addTodo={addTodo}/>
                <Todos toggleTodo={toggleTodo} removeTodo={removeTodo} todos={todos}/>
            </div>
        )
    }
    ReactDOM.render(
        <TodoList/>,
        document.getElementById("server")
    )

</script>
</body>
</html>