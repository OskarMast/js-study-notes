<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Promise</title>
	</head>
	<body>
		<script>
			// Promise对象用于表示一个异步操作的最终状态(完成或失败),以及该异步操作的结果值.
			let p1 = new Promise(function(resolve,reject){
				setTimeout(function(){
					resolve("foo");
				},300);
			});
			p1.then(function(value){
				console.log(value);
			});
			
			function cb(){
				console.log("Done");
			}
			console.log("before");
			setTimeout(cb,2000);
			console.log("after");
			
			// 生成一个0-2之间的随机数,如果小于1,则等待一段时间后返回成功,否则返回失败;
			function test(resolve,reject){
				let number = Math.random()* 2;
				console.log("waiting for " + number + "seconds");
				setTimeout(function(){
					if(number < 1){
						console.log("resolve()...");
						resolve("200 OK");
					}else{
						console.log("reject()...");
						reject("404 err");
					}
				},number*1000);
			}
			new Promise(test).then(function(data){
				console.log(data);
			}).catch(function(err){
				console.log(err);
			});
			
			setTimeout(function(data){
				console.log(data);
			},1000,2 * 3);
			
			function multiply(input){
				return new Promise(function(resolve,reject){
					console.log("calcaluting..." + input + "X" + input);
					setTimeout(resolve,500,input*input);
				})
			}
			function add(input){
				return new Promise(function(resolve,reject){
					console.log("calcaluting..." + input + "+" + input);
					setTimeout(resolve,500,input+input);
				})
			}
			let p = new Promise(function(resolve,reject){
				console.log("start Promise...");
				resolve(123);
			});
			p.then(multiply).then(add).then(function(data){
				console.log(data);
			});
			
			let p2 = new Promise(function(resolve,reject){
				resolve("Hello World");
			});
			p2.then(function(data){
				console.log(data);
			});
			
			let pro1 = new Promise(function(resolve,reject){
				setTimeout(function(){
					resolve("P1");
				},500);
			});
			let pro2 = new Promise(function(resolve,reject){
				setTimeout(function(){
					resolve("P2");
				},500);
			});
			Promise.all([pro1,pro2]).then(function(result){
				console.log(result);
			});
		</script>
	</body>
</html>
