<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>useRef</title>
</head>
<body>
<div id="root"></div>
<div id="app"></div>
<div id="count"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script type="text/babel">
/*    const Counter = React.memo(function Counter(props){
        console.log("counter render");
        console.log(props);
        return (
            <div>
                <p onClick={props.onClick}>Counter - count : {props.count}</p>
            </div>
        )
    })*/
    class Counter extends React.PureComponent {
        constructor(props){
            super(props);
        }
        getCount = () => {
            console.log("current - count " + this.props.count);
        }
        render(){
            const {props} = this;
            return (
                <div>
                    <p onClick={props.onClick}>Counter - count : {props.count}</p>
                </div>
            )
        }
    }

    function App(){
        const counterRef = React.useRef();
        const [count,setCount] = React.useState(0);
        const timerRef = React.useRef();
        const handleClick = () => {
            setCount(count+1);
        }
        const doubleCount = (count) => {
            return count * 2;
        }
        // const dbCount = doubleCount(count);
        const dbCount = React.useMemo(() => {
            return doubleCount(count);
        },[count === 3]);

        const handleCount = React.useCallback(() => {
            counterRef.current.getCount();
        },[counterRef]);

        React.useEffect(() => {
            timerRef.current = setInterval(() => {
                setCount(count => count+1);
            },1000)
        },[])
        React.useEffect(() => {
            if(count >= 10){
                clearInterval(timerRef.current);
            }
        })
        return (
            <div>
                <p>double - count : {dbCount}</p>
                <p>current - count : {count}</p>
                <Counter
                    count={dbCount}
                    onClick={handleCount}
                    ref={counterRef}
                />
                <button
                    children="click"
                    onClick={handleClick}
                />
            </div>
        )
    }
    ReactDOM.render(
        <App/>,
        document.getElementById("root")
    )

    class Child extends React.Component {
        speak = () => {
            console.log("child function");
        }
        render(){
            return (
                <div>
                    <button onClick={() => {this.speak()}}>click</button>
                </div>
            )
        }
    }

    function Parent (){
        const parentRef = React.useRef();
        const handleClick = () => {
            console.log("parent render");
            parentRef.current.speak();
        }
        return (
            <div>
                <hr/>
                <button onClick={handleClick}>click-调用子组件方法</button>
                <Child ref={parentRef}/>
            </div>
        )
    }

    ReactDOM.render(
        <Parent/>,
        document.getElementById("app")
    )


    function CountComponent(){
        const [number,setNumber] = React.useState(0);
        const textRef = React.useRef();
        const it = React.useRef();
        React.useEffect(() => {
            it.current = setInterval(() => {
                setNumber(number => number + 1);
            },1000)
        },[])
        React.useEffect(() => {
            if(number >= 10){
                clearInterval(it.current);
            }
        })
        const handleClick = () => {
            console.log(textRef.current.textContent);
        }
        return (
            <div>
                <hr/>
                <p ref={textRef}>{number}</p>
                <button
                    onClick={handleClick}
                >click</button>
            </div>
        )
    }

    ReactDOM.render(
        <CountComponent/>,
        document.getElementById("count")
    )

</script>
</body>
</html>