<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>useMemo</title>
</head>
<body>
<div id="server"></div>
<div id="root"></div>
<div id="demo"></div>
<script src="./node_modules/babel-standalone/babel.js"></script>
<script src="./node_modules/react/umd/react.development.js"></script>
<script src="./node_modules/react-dom/umd/react-dom.development.js"></script>
<script type="text/babel">
    function Counter (props){
        return (
            <p>Counter-count:{props.count}</p>
        )
    }

    function App(){
        const [count,setCount] = React.useState(0);
        const handleClick = () => {
            setCount(count+1)
        }
        const double = React.useMemo(() => {
            return count * 2;
        },[count])
        return (
            <div>
                <p>App-count:{count}</p>
                <Counter count={count}/>
                <p>Memo-count:{double}</p>
                <button
                    onClick={handleClick}
                >Submit</button>
            </div>
        )
    }
    ReactDOM.render(
        <App/>,
        document.getElementById("server")
    )

    // 将修改的两个属性传递给子组件,接受的子组件 将其中一个数据title修改, 每次修改content时,也会导致title修改函数的执行
    function Root(){
        const [title,setTitle] = React.useState("title");
        const [content,setContent] = React.useState("content");
        return (
            <React.Fragment>
                <button onClick={() => {setTitle(new Date().getTime())}}>title</button>
                <button onClick={() => {setContent(new Date().getTime())}}>content</button>
                <Bar title={title}>{content}</Bar>
            </React.Fragment>
        )
    }

    function Bar({title,children}){
        function changeTitle(title){
            console.log("title修改了");
            return title + "修改title的方法";
        }
        const otherTitle = React.useMemo(() => {
            return changeTitle(title);
        },[]);
        // const otherTitle = React.useCallback(changeTitle(title));
        return (
            <div>
                <hr/>
                <p>title: {otherTitle}</p>
                <p>content: {children}</p>
            </div>
        )
    }

    ReactDOM.render(
        <Root/>,
        document.getElementById("root")
    )

    const Count = React.memo(
        function Count({count}){
            console.log("count render");
            return (
                <div>
                    <div>子组件count:{count}</div>
                </div>
            )
        }
    )

    function Demo(){
        const [count,setCount] = React.useState(0);
        const [time,setTime] = React.useState(new Date().getMilliseconds());
        const handleClick = () => {
            setCount(count+1);
        }
        const handleTime = () => {
            setTime(new Date().getMilliseconds())
        }
        function doubleCount(count){
            console.log("count计算了");
            return count * 2;
        }
/*        const handleChange = () => {
            console.log("Click");
        }*/
        const handleChange = React.useMemo(() => {
            return () => {
                console.log("Click");
            }
        },[])
        const dbcount = React.useMemo(() => {
            return doubleCount(count);
        },[count === 3])   // 空数组只会执行一次，参数count表示依赖于count改变 决定是否执行
        // count === 3，count为0 1 2 的时候 不会执行dbcount,count为3时 从false->true,再count自增为4,从true->false dbcount会重新计算。
        return (
            <React.Fragment>
                <hr/>
                <div>
                    <p>click {count} times</p>
                    <p>double-count:{dbcount}</p>
                    <p>time:{time}</p>
                    <Count count={dbcount} handleChange={handleChange}/>
                    <button onClick={handleClick}>changeCount</button>
                    <button onClick={handleTime}>changeTime</button>
                </div>
            </React.Fragment>
        )
    }

    ReactDOM.render(
        <Demo/>,
        document.getElementById("demo")
    )
</script>
</body>
</html>