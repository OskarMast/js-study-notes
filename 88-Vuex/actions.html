<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Vuex-actions</title>
		<style>
			#server{
				text-align:center;
			}
		</style>
	</head>
	<body>
		<div id="server">
			<p>Action类似Mutition,不同在于:</p>
			<h4>Action提交的是mutation,而不是直接变更状态</h4>
			<h4>Action可以包含任意异步操作</h4>
			<my-server></my-server>
		</div>
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/vuex@2.0.0"></script>
		<script>
			const store = new Vuex.Store({
				state:{
					count:0
				},
				mutations:{
					increment(state,n){
						state.count += n;
					},
					incrementAsync(state,n){
						state.count += n;
					},
					multiplyAsync(state,playload){
						state.count *= playload.number;
					}
				},
				actions:{
					increment(context){
						context.commit("increment",2);
					},
					incrementAsync(context){
						setTimeout(()=>{
							context.commit("incrementAsync",2)
						},2000);
					},
					multiplyAsync({commit},playload){
						setTimeout(() => {
							commit("multiplyAsync",playload);
						},2000)
					}
				}
			});
			const myApp = Vue.component("my-server",{
				template:`<div>
					<button @click="handleAdd">+2</button>
					<button @click="handleAddAsync">异步+2</button>
					<button @click="handleMultiplyAsync">异步*2</button>
					<p>{{this.$store.state.count}}</p>
				</div>`,
				methods:{
					handleAdd(){
						this.$store.dispatch("increment");
					},
					handleAddAsync(){
						this.$store.dispatch("incrementAsync");
					},
					handleMultiplyAsync(){
						this.$store.dispatch("multiplyAsync",{number:2});
					}
				}
			})
			new Vue({
				el:"#server",
				store,
				components:{
					"my-server":myApp
				}
			})
		</script>
	</body>
</html>
