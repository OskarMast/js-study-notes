<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>yield关键字</title>
</head>
<body>
    <script>
        function* foo(){
            for(let i = 0; true; i++){
                let reset = yield i;
                console.log(reset);
                if(reset){i = -1};
            }
        }
        let f = foo();
        // console.log( f.next() );    // {value:0,done:false}
        console.log( f.next('done') );  
        console.log( f.next() );    
        

        function* valueOfYield(){
            console.log('Hello World');
            let value_of_yield = yield 1;
            console.log('value of yield',value_of_yield);
        }
        let it = valueOfYield();
        console.log(it.next()); // {value:1,done:false}

        function* bar(x){
            let y = (yield( x + 1));
            let z = yield( y / 3);
            return (x + y + z);
        }
        // let a = bar(5);
        // console.log(a.next());  // {value:6,done:false}
        // console.log(a.next());  // {value:NaN,done:false}
        // console.log(a.next());  // {value:NaN,done:true}

        let b = bar(5);
        console.log(b.next());  // {value:6,done:false}
        console.log(b.next(12));    // {value:8:done:false}
        console.log(b.next(13));    // {value:30,done:false}

        // 有return的时候
        function* say(){
            yield 'Hello';
            yield 'World';
            return 'ok';
        }
        let is = say();
        console.log(is.next()); //{value:'Hello',done:false}
        console.log(is.next()); // {value:'World',done:false}
        console.log(is.next()); // {value:ok,done:true}

        // 没有return 的时候
        function* m1(){
            yield 'Hello';
            yield 'World';
        }
        let m = m1();
        console.log(m.next());  // {value:'Hello',done:false}
        console.log(m.next());  // {value:'World',done:false}
        console.log(m.next());  // {value:undefined,done:true}

        function* dataConsumer(){
            console.log('Started');
            console.log(`1. ${yield}`);
            console.log(`2. ${yield}`);
            return 'result';
        }
        let genObj = dataConsumer();
        console.log( genObj.next() );   // {value:undefined,done:false}
        console.log( genObj.next('a')); // 1.a
        console.log( genObj.next('b')); // 2. b

        function* baz(){
            yield 1;
            yield 2;
            yield 3;
            yield 4;
            yield 5;
            return 6;
        }
        let obj = baz();
        console.log(obj);

        for(let v of baz()){
            console.log(v);
        }

        // 斐波拉契数列 
        // 第三个数是前两个数的和
        // 0 1 1 2 3 5 8 13 21 34
        function f1(){
            let [a1,a2,sum] = [1,1,0];
            for(let i = 1; i < 10; i++){
                a1 = a2;
                a2 = sum;
                sum = a1 + a2;
                console.log(sum,i);
            }
        }
        f1();

        function* fibonacci(){
            let [prev,cur] = [0,1];
            for(;;){
                yield cur;
                [prev,cur] = [cur,prev + cur];
            }
        }
        function* f2(){
            for(;;){
                yield 'Hello';
            }
        }
        let fff = f2();
        console.log(fff.next());
        console.log(fff.next());
        console.log(fff.next());


        function* feibo(){
            let [prev,cur] = [0,1];
            for(; true ; ){
                yield cur;
                [prev,cur] = [cur,prev + cur];
            }
        }
        let fei = feibo();
        // console.log(fei.next());    // 1
        // console.log(fei.next());    // 1
        // console.log(fei.next());    // 2
        // console.log(fei.next());    // 3
        // console.log(fei.next());    // 5
        // console.log(fei.next());    // 8

        for(let n of feibo()){
            if(n > 120) break;
            console.log(n); // 1 1 2 3 5 8
        }
        // 1 1 2 3 5 8
        function f3(n){
            let [prev,cur,sum] = [1,1,0];
            for(let i = 1; i <= n; i++){
                prev = cur;
                cur = sum;
                sum = prev + cur;
            }
            return sum;
        }
        let res = f3(100);
        console.log(res);

        function* objectEntries(obj){
            let propKeys = Reflect.ownKeys(obj);
            for(let propKey of propKeys){
                yield [ propKey, obj[propKey] ];
            }
        }
        let jane = {first:'Jane',lase:'Doe'};
        for(let [key,value] of objectEntries(jane) ){
            console.log(key,value);
        }

        for(let key of Reflect.ownKeys(jane)){
            console.log(key,jane[key]);
        }
        console.log(Reflect.ownKeys(jane)); // 返回一个键名数组 ['first','last'];

        for(let [key,value] of Object.entries(jane)){
            console.log(key,value);
        }
        // for(let key of jane){
        //     console.log(key);   // jane is not iterator
        // }


        let player = {
            first:'kyrie',
            last:'irving',
            team:'Celtic',
            position:'guard'
        }
        console.log(Object.entries(player));
        for(let [key,value] of Object.entries(player)){
            console.log(key,value);
        }
        for(let key of Object.keys(player)){
            console.log(key);
        }
        for(let value of Object.values(player)){
            console.log(value);
        }

        function* objEntries(){
            let propKeys = Reflect.ownKeys(this);
            for(let propKey of propKeys){
                yield [ propKey,this[propKey] ];
            }
        }
        let ai = {first:'Allen',last:'Doe'};
        ai[Symbol.iterator] = objEntries;

        for(let [k,v] of ai){
            console.log(k,v);
        }
        // for(let item of player){
        //     console.log(item);
        // }
        Object.prototype[Symbol.iterator] = function* (){
            // for(let key in this){
            //     yield this[key];
            // }
            let propKeys = Reflect.ownKeys(this);
            for(let propKey of propKeys){
                yield this[propKey];
            }
        }
        for(let item of player){
            console.log(item);
        }

        function* numbers(){
            yield 1;
            yield 2;
            yield 3;
            yield 4;
            return 3;
            yield 5;
        }
        console.log([...numbers()]);    // [1,2]
        console.log(Array.from(numbers())); // [1,2]
        let [x,y,...z] = numbers();
        console.log(x,y,z); // 1 2 [3,4]

        for(let n of numbers()){
            console.log(n); // 1 2 3 4
        }
        
        function* fun(){
            for(var i = 0; true; i++){
                let reset = yield i;
                if(reset) {
                    i = -1;
                }
            }
        }
        let way = fun();
        console.log( way.next() );  // {value:0,done:false}
        console.log( way.next() );  // {value:1,done:false}
        console.log( way.next(true) );

        function* gen(){
            let result1 = yield 'Hello';
            let result2 = yield 'World';
            return result1 + result2;
        }
        let g = gen();
        console.log( g.next() );// {value:'Hello',done:false}
        console.log( g.next(1) );   // {value:'World',done:false}
        console.log( g.next(2) );   // {value:3,done:false}

        function* gap(){
            try{
                yield;
            }catch(error){
                console.log('内部捕获',error);
            }
        }
        let i = gap();
        i.next();
        try{
            i.throw('a');
            i.throw('b');
        }catch(e){
            console.log('外部捕获',e);
        }
        function* glass(){
            try{
                yield;
            }catch(e){
                console.log(e);
            }
        }
        let its = glass();
        its.next();
        its.throw( new Error('出错了') );


        function* fool(){
            while(true){
                try{
                    yield;
                }catch(e){
                    if(e != 'a') throw e;
                    console.log('内部捕获',e);
                }
            }
        }
        var n = fool();
        n.next();
        try{
            throw new Error('a');
            throw new Error('b');
        }catch(e){
            console.log('外部捕获',e);
        }
    </script>
</body>
</html>