<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Vuex-review</title>
	</head>
	<body>
		<div id="server">
			<my-component></my-component>
		</div>
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/vuex@2.0.0"></script>
		<script>
			const myComponent = Vue.component("my-component",{
				template:`<div>
					<p>{{$store.state.count}}</p>
					<p>list: {{$store.getters.filterList}}</p>
					<p>数组长度:{{$store.getters.listCount}}</p>
					<button @click="handleAdd">+1</button>
					<button @click="handleReduce">-1</button>
					<button @click="handleAddAsync">+1(1500ms)</button>
					<button @click="handleReduceAsync">-1(2000ms)</button>
					<button @click="handleMultiplyAsync">*2(1500ms)</button>
				</div>`,
				methods:{
					handleAdd(){
						this.$store.commit("increment",5);
					},
					handleReduce(){
						this.$store.commit("decrease");
					},
					handleAddAsync(){
						this.$store.dispatch("increment");
					},
					handleReduceAsync(){
						this.$store.dispatch("reduce").then(res=>{
							console.log(res);
						})
					},
					handleMultiplyAsync(){
						const _this = this;
						this.$store.dispatch("multiplyAsync",function(){
							console.log(_this.$store.state.count);
						})
					}
				}
			});
			const store = new Vuex.Store({
				state:{
					count:0,
					list:[1,5,8,10,50,50]
				},
				mutations:{
					increment(state,n = 1){
						// 给函数一个默认参数 n=1 相当于 n = n || 1;
						state.count += n;
					},
					decrease(state,n = 1){
						state.count -= n;
					},
					multiply(state,n=2){
						state.count = state.count*n;
					}
				},
				getters:{
					// getters 返回 数组中小于10的数字
					filterList:state => {
						return state.list.filter(item => item < 10);
					},
					// getters也可以作为其他getters的参数
					listCount:(state,getters)=>{
						return getters.filterList.length;
					}
				},
				actions:{
					increment(context){
						setTimeout(()=>{
							context.commit("increment");
						},1500);
					},
					reduce(context){
						return new Promise((resolve,reject)=>{
							setTimeout(()=>{
								context.commit("decrease");
								resolve("我执行完成了");
							},2000);
						})
					},
					multiplyAsync(context,callback){
						setTimeout(()=>{
							context.commit("multiply",3);
							callback();
						},1500);
					}
				}
			});
			new Vue({
				el:document.getElementById("server"),
				components:{
					"my-component":myComponent
				},
				store
			});
			
			
			// ES6 的 promise, 是一种异步方案,有3种状态, pending(进行中),resolved(已完成) reject(已失败);
			const promise = new Promise((resolve,reject)=>{
				setTimeout(()=>{
					const random = Math.random();
					if(random > 0.5){
						resolve(random);
					}else{
						reject(random);
					}
				},1000);
			});
			promise.then((res)=>{
				console.log("success",res);
			}).catch((err)=>{
				console.log("err",err);
			})
		</script>
	</body>
</html>
