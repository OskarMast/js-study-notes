<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>字符串和数组的扩展</title>
    <style>
        body,ul,ol{
            padding: 0;
            margin: 0;
        }
        ol,ul{
            list-style:none;
        }
    </style>
</head>
<body>
    <ul class="list">
        <li class='item' name='hello'>kyrie</li>
        <li class='item'>lebron</li>
        <li class='item'>durant</li>
        <li class='item'>curry</li>
        <li class='item'>wade</li>
    </ul>
    <div class="box">1</div>
    <div class="box">2</div>
    <div class="box">3</div>
    <div class="box">4</div>
    <div class="box">5</div>
    <script>
        var str = 'abcdefg';
        var flag = str.includes('a');
        console.log(flag); 
        
        var a = 'Hello World!';
        console.log( a.startsWith('Hello') );   // true
        console.log( a.endsWith('Hello') ); // false
        console.log( a.startsWith('World') );   // false
        console.log( a.endsWith('World!') );    // true
        
        // 封装includes方法 (传入两个参数,第一个参数为遍历的字符串,第二个字符串为目标字符串)
        /*
        1. 先求出目标字符串的长度,然后遍历字符串,以目标字符串的长度为单位判断 源字符串中是否有 和 目标字符串相等的部分
        2. 如果有,则返回true
        3. 没有,则返回false,注意检索时的限制条件
        */
        function includes(string,checkStr){
            var l = checkStr.length;
            for(let i = 0,len = string.length; i < len-l+1; i++){
                if( string.substr(i,l) == checkStr){
                    console.log('true',i);
                }else{
                    console.log('false',i);
                }
            }
        }
        includes(str,'efg');

        var arr = [1,2,3,4,5,6];
        var result = arr.every(function(i,j){
            return i < 10;
        });
        console.log(result);    // true;
        var d = arr.some((i,j)=>i>5);
        console.log(d); // true


        // 将类数组变成数组
        var aLi = document.querySelectorAll('.list li');
        // console.log([...aLi]);
        

        // rese参数与扩展运算符
        function add(...items){
            var sum = 0;
            for(let val of items){
                sum += val;
            }
            console.log(sum);
        }
        add(2,3,5);

        function push(array,...items){
            items.forEach(function(item){
                array.push(item);
            });
            console.log(array);
        }
        push([],'a','b','c');

        let newArr = Array.from(aLi);
        console.log(aLi);
        console.log(newArr);    
        console.log(aLi);

        // 获取每个li的innerHTML
        var content = Array.from(aLi,(i)=>i.innerHTML);
        console.log(content);
        console.log(typeof aLi[0].innerHTML);

        var player = Array.from(aLi,item=>item.innerHTML);
        console.log(player);

        let array = [];
        for(let i = 0; i < aLi.length; i++){
            array.push( aLi[i].innerHTML );
        }
        console.log(array);

        let arrayLike = {
            0:'kyrie',
            1:'lebron',
            2:'durant',
            3:'curry',
            4:'wade',
            length:5    // length是必须的
        };
        let arr2 = Array.from(arrayLike);
        console.log(arr2);

        // Array.of()
        var a = new Array(10);
        console.log(a);
        var b = Array(10);
        console.log(b);

        var c = Array.of(10);
        console.log(c);

        console.log(...[1,2,3]);
        console.log(...[2,3,4]);

        function sum(x,y){
            console.log(x + y);
        }
        const numbers = [4,38];
        sum(...numbers);    // 42

        // 扩展运算符取代apply的方法
        var max1 = Math.max.apply(null,[14,4,77,22,15,30,18]);
        var max2 = Math.max.call(null,...[14,4,77,22,15,30,18]);
        var max3 = Math.max(...[14,4,77,22,15,30,18]);
        var min1 = Math.min.apply(null,[14,4,77,22,15,30,18]);
        var min2 = Math.min.call(null,...[14,4,77,22,15,30,18]);
        var min3 = Math.min(...[14,4,77,22,15,30,18]);

        console.log(max1,max2,max3);    // 77 77 77 
        console.log(min1,min2,min3);    // 4 4 4
        
        var arr3 = [123,'ab3c','12ab','ccd','3d','jk','235'];
        // 找出上列数组中以数字开头的项
        arr3.forEach(function (item,index){
            if( !isNaN(parseInt(item)) ){
                console.log(item);  // 123 12ab 3d 235
            }
        });

        console.log( parseInt(arr3[1]) === NaN );   // false

        arr3.filter(function(i,j){
            if( !isNaN(parseInt(i)) ){
                console.log(i);  // 123 12ab 3d 235
            }
        });

        var target = arr3.filter((i,j)=>!isNaN(parseInt(i)));
        console.log(target);    // [123, "12ab", "3d", "235"]   
        console.log(typeof target); // object
        
        var oDiv = document.querySelectorAll('.box');
        console.log(oDiv);  // 有entries() forEach() item() keys() values() 
        console.log(oDiv.constructor == NodeList);  // true
        console.log(oDiv.__proto__ == NodeList.prototype);  // true
        var oBox = document.getElementsByTagName('div');
        console.log(oBox);  // HTMLCollection
        var oClass = document.getElementsByClassName('box');
        console.log(oClass);    // HTMLCollection   
        
        oDiv.forEach(i=>i.style.color = '#f00');
        // oBox.forEach(i=>i.style.color='#00f');  // oBox.forEach is not a function
        [...oBox].forEach(i=>i.style.fontSize = '20px');
        Array.apply(null,oBox).forEach(i=>i.style.color='#f0f');
        Array.from(oBox).forEach(i=>i.style.color='#0f0');
        

        // forEach() 底层实现
        Array.prototype.myForEach = function(callback,obj){
            console.log(this);
            let temp = obj?obj:this;
            for(let i = 0; i < this.length; i++){
                callback && callback.call(temp,this[i],i,this);    
                // call把this指向修改为当前数组
            }
        };
        var arr4 = [3,4,5];
        arr4.myForEach();   // [3,4,5]; // 指向调用的数组
        [1,2,3].myForEach(function(item,index,array){
            console.log(item,index,array);
            console.log(this);
        });
        
        arr4.forEach(function(item){
            console.log(this);  // window
            console.log(item);
        });

        Array.prototype.ForEach = function(callback){
            console.log(this);
            for(let j = 0 , len = this.length; j < len; j++){
                callback && callback(this[j]);
            }
        }
        arr4.ForEach(function(item){
            console.log(this);  // window
            console.log(item);  // 
        });

        var ages = [1,2,3,4,5];
        var total = ages.reduce(function(i,j){
            return i+j;
        });
        console.log(total); // 15

        // str.split().reduce( (x,y)=>((x[y]?x[y]++:x[y]=1),x){})
        var ages = [1,2,3,4,5];
        ages.reduce(function(i,j,k,l){
            console.log(i,j,k,l);   // {} 1 0 [1,2,3,4,5]
                                    // undefined 2 1 [1,2,3,4,5]
                                    // undefined 3 2 [1,2,3,4,5]
                                    // undefined 4 3 [1,2,3,4,5]
                                    // undefined 5 4 [1,2,3,4,5]
        },{});

        var str = 'aabbccccesdeddssaabcd';
        let obj = str.split('').reduce( (x,y)=>((x[y]?x[y]++:x[y]=1),x),{} );
        console.log(obj);
        
        let number = [15,2,1,4,3,12,7];
        var accu = number.reduce(function(accumulator,currentValue){
            return accumulator+currentValue;
        });
        
        var sum = 0;
        number.filter(function(item,index){
            console.log(item,index,this);   // this默认指向window,在没有传入初始值的情况下
            sum+=item;
            console.log(sum);
        });

        let arr5 = new Array(100).fill(0).map((i,j)=>j).sort((a,b)=>Math.random()-.5);
        console.log(arr5);
        let maxNumber = arr5.reduce((acc,cur)=>acc>cur?acc:cur);
        console.log(maxNumber); // 99
        console.log( number.reduce((i,j)=>i>j?i:j) );   // 15
        
        function m1(a,b){
            // return (a+b,3);
            return a+b;
        }
        var m = m1(2,3);
        console.log(m); // 3        / 5

        console.log([].reduce(((i,j)=>j),{}));  // {}

        console.log( [1].reduce((i,j)=>j) );
        [1,2,3].reduce(function(i,j){
            console.log('函数执行了');  // 2次
        });
        [1].reduce(function(i,j){
            console.log('函数执行了');  // 没有执行
        });
        [].reduce(function(i,j){
            console.log('函数执行了');
        },{});

        var aLi1 = document.querySelectorAll('.list>li');
        var aLi2 = document.getElementsByTagName('li');
        var aLi3 = document.getElementsByClassName('item');
        console.log(aLi1);  
        console.log(aLi2);
        console.log(aLi3);
        console.log(aLi1.item(1));  // lebron
        console.log(aLi2.item(1));  // lebron
        console.log(aLi3.item(1));  // lebron

        aLi1.forEach(item=>console.log(item));
        // aLi2.forEach(item=>(console.log(item)));    // 会报错
        // aLi3.forEach(item=>console.log(item));  //报错
        // aLi1.filter(item=>console.log(item));   // 报错
        console.log( aLi2.namedItem('hello') );
        
        console.log([1,2,3].forEach(i=>console.log(i+1)));   // undefined
        console.log( [1,2,3].filter(i=>console.log(i+1)),{});  // [1,2,3]
        console.log( [1,2,3].map(i=>console.log(i+1)) ); // [2,3,4]  // 
        

        // map不会改变源数组
        var arr6 = [2,4,6];
        console.log(arr6.map(i=>i+1));  // [3,5,7]
        console.log(arr6);  // [2,4,6]
        
        // 字符串和数组都有includes方法,
        console.log( [1,2,3].includes(2) ); // true
        console.log( [1,2,NaN].includes(NaN));  // true
        console.log( [undefined,null].includes(undefined)); // true

        console.log( '12345'.includes('123') );   // true
        console.log( 'james'.includes('ja'));   // true
        console.log( 'undefined'.includes(undefined) ); // true
        
        let array1 = ['kyrie','lebron','durrant','curry'];
        for(let item of array1.keys()){
            console.log(item);  // 0 1 2 3
        }
        console.log(array1.keys()); // 返回一个遍历器对象

        for(let item of array1.entries()){
            console.log(item);  // 键值对的遍历
        }
        for(let item of array1.values()){
            console.log(item);
        }
        
        for(let item in array1.keys()){
            console.log(item);  // 遍历不出来
        }
        for(let item in array1.entries()){
            console.log(item);  // 遍历不出来
        }
        for(let item in array1.values()){
            console.log(item);  // 遍历不出来
        }
    </script>       
</body>
</html>